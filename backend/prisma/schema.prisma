generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")  
}

model Admin {
  id       Int      @id @default(autoincrement())
  email    String   @unique
  password String
}

model Client {
  idClient    Int       @id @default(autoincrement())
  userName    String
  creditCard  String?
  address     String
  cin         Int       @unique
  phoneNum    Int       @unique
  email       String    @unique
  password    String
  picture     String?
  Orders      Order[]   @relation("ClientOrders")
  Favorites   Favorite[]
  Messages    Message[]
}

model Order {
  idorders   Int           @id @default(autoincrement())
  startDate  String?
  endDate    String?
  clientId   Int
  Client     Client        @relation("ClientOrders", fields: [clientId], references: [idClient])
  Workers    Worker[]      @relation("OrderWorkers")
  Products   Product[]     @relation("OrderProducts")
}

model Product {
  idproducts   Int       @id @default(autoincrement())
  name         String
  category     String
  description  String
  price        Int
  picture      String
  rating       Int
  stock        Int
  numOfRatings Int
  ordersId     Int?      // Nullable by default
  Order        Order?    @relation("OrderProducts", fields: [ordersId], references: [idorders])
  Favorites    Favorite[]
}

model Favorite {
  clientId    Int
  productsId  Int
  Client      Client    @relation(fields: [clientId], references: [idClient])
  Product     Product   @relation(fields: [productsId], references: [idproducts])

  @@id([clientId, productsId])
}

model Worker {
  idworker     Int       @id @default(autoincrement())
  cin          Int
  creditCard   String?
  userName     String
  phoneNum     Int
  email        String?   @unique
  password     String?
  rentedProd   String?
  picture      String?
  resume       String?
  rating       Int?
  jobTitle     String?
  hourlyRate   Float?
  available    Boolean?
  address      String?
  ordersId     Int?
  latitude     Decimal?
  longitude    Decimal?
  status       Boolean?
  comments     String?
  Order        Order?    @relation("OrderWorkers", fields: [ordersId], references: [idorders])
  Messages     Message[]

  @@index([ordersId], name: "idx_ordersId") // Optional: Index for faster lookups
}



model Message {
  id              Int            @id @default(autoincrement())
  senderId        Int
  recipientId     Int
  content         String
  conversationId  Int

  Sender          Client?        @relation(fields: [senderId], references: [idClient])
  Recipient       Worker?        @relation(fields: [recipientId], references: [idworker])
  Conversation    Conversation   @relation(fields: [conversationId], references: [id])

  @@index([conversationId], name: "idx_conversationId")
}

model Conversation {
  id         Int       @id @default(autoincrement())
  title      String?
  Messages   Message[]
}